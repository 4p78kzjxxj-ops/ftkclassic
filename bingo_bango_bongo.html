<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Bingo Bango Bongo</title>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<link rel="icon" type="image/png" href="IMG_7296.jpg" />

<style>
:root{
  --bg0:#0b1220;
  --bg1:#0f172a;
  --stroke:rgba(255,255,255,.12);
  --text:#e5e7eb;
  --muted:rgba(229,231,235,.65);
  --accent:#60a5fa;
  --good:#34d399;
  --danger:#f87171;
  --radius:20px;
  --tap:44px;
}

*{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;}
body{
  background:linear-gradient(180deg,var(--bg0),var(--bg1));
  color:var(--text);
  min-height:100vh;
  padding:12px;
  padding-bottom:24px;
}

button{border:0;background:none;color:inherit;}
select{
  height:44px;border-radius:14px;
  background:#020617;border:1px solid var(--stroke);
  color:var(--text);padding:0 12px;
}

/* ===== Top bar (menu only) ===== */
.appbar{
  position:sticky;
  top:8px;
  z-index:50;
  display:flex;
  justify-content:flex-end;
}
.menuBtn{
  width:44px;height:44px;
  border-radius:14px;
  background:rgba(255,255,255,.06);
  border:1px solid var(--stroke);
  font-size:20px;
}

/* ===== Menu ===== */
.menu-overlay{
  position:fixed;inset:0;
  background:rgba(0,0,0,.4);
  display:none;z-index:200;
}
.menu{
  position:fixed;
  top:60px;left:12px;right:12px;
  background:rgba(15,23,42,.98);
  border-radius:22px;
  border:1px solid var(--stroke);
  display:none;z-index:201;
}
.menu h3{
  padding:14px;
  font-size:.75rem;
  text-transform:uppercase;
  letter-spacing:.12em;
  color:var(--muted);
}
.menu button,.menu a{
  width:100%;
  padding:14px;
  border-top:1px solid var(--stroke);
  font-weight:800;
  text-align:left;
}
.menu .danger{color:#fee2e2;background:rgba(248,113,113,.12);}

/* ===== Cards ===== */
.card{
  background:rgba(255,255,255,.05);
  border:1px solid var(--stroke);
  border-radius:22px;
  padding:14px;
  margin-top:12px;
}

/* ===== Scoreboard (Mode C) ===== */
.player{
  background:rgba(2,6,23,.7);
  border:1px solid var(--stroke);
  border-radius:18px;
  padding:10px;
  margin-top:8px;
}
.player-head{
  display:flex;
  justify-content:space-between;
  font-weight:900;
}
.buckets{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:8px;
  margin-top:8px;
}
.bucket{
  background:rgba(255,255,255,.04);
  border:1px solid var(--stroke);
  border-radius:16px;
  padding:8px;
}
.bucket small{
  font-size:.65rem;
  text-transform:uppercase;
  letter-spacing:.1em;
  color:var(--muted);
}
.plus{
  margin-top:6px;
  width:100%;
  height:44px;
  border-radius:999px;
  background:rgba(52,211,153,.12);
  border:1px solid rgba(52,211,153,.4);
  font-weight:900;
  font-size:1.05rem;
}

/* ===== Leaderboard (menu only) ===== */
.lb-row{
  display:flex;
  justify-content:space-between;
  padding:10px;
  border-top:1px solid var(--stroke);
  font-weight:800;
}
.lb-row:first-child{border-top:none;}
.lb-total{
  background:rgba(255,255,255,.08);
  border-radius:999px;
  padding:4px 10px;
}

/* ===== Log ===== */
.log{display:none;}
details{
  border:1px solid var(--stroke);
  border-radius:16px;
  margin-top:8px;
  background:rgba(255,255,255,.04);
}
summary{
  padding:12px;
  cursor:pointer;
  font-weight:900;
}
.log-item{
  padding:10px 12px;
  border-top:1px solid var(--stroke);
  font-size:.9rem;
}
</style>
</head>

<body>

<!-- MENU -->
<div id="menuOverlay" class="menu-overlay"></div>
<div id="menu" class="menu">
  <h3>Leaderboard</h3>
  <div id="leaderboard"></div>

  <h3>Hole</h3>
  <select id="holeSelect"></select>

  <h3>Log</h3>
  <button id="toggleLogBtn">Show / Hide Log</button>

  <button id="endSessionBtn" class="danger">End Session</button>
</div>

<!-- TOP BAR -->
<div class="appbar">
  <button id="menuBtn" class="menuBtn">â˜°</button>
</div>

<!-- SCOREBOARD -->
<div id="scoreboard"></div>

<!-- LOG -->
<div id="log" class="card log"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue, update, push, set } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp({
  apiKey:"AIzaSyD5fk91DPgPBkJ3_xGnNntD3PQbi5Ib3kg",
  databaseURL:"https://ftkclassicdb-default-rtdb.firebaseio.com"
});
const db = getDatabase(app);

const params=new URLSearchParams(location.search);
const sessionId=params.get("session");

const els={
  menu:menu,overlay:menuOverlay,
  leaderboard,scoreboard,log,
  holeSelect,toggleLogBtn,endSessionBtn
};

menuBtn.onclick=()=>{menu.style.display="block";overlay.style.display="block";}
overlay.onclick=()=>{menu.style.display="none";overlay.style.display="none";}

toggleLogBtn.onclick=()=>els.log.classList.toggle("log");

endSessionBtn.onclick=()=>{
  if(confirm("End session?")){
    update(ref(db,`games/bingoBangoBongo/sessions/${sessionId}`),{status:"ended"});
    location.href="games.html";
  }
};

onValue(ref(db,`games/bingoBangoBongo/sessions/${sessionId}`),snap=>{
  const d=snap.val(); if(!d)return;
  const scores=d.scores||{};
  const players=d.players||{};

  // Hole select
  holeSelect.innerHTML=[...Array(18)].map((_,i)=>`<option ${d.currentHole==i+1?"selected":""}>Hole ${i+1}</option>`).join("");
  holeSelect.onchange=()=>update(ref(db,`games/bingoBangoBongo/sessions/${sessionId}`),{currentHole:holeSelect.selectedIndex+1});

  // Leaderboard
  const rows=Object.keys(players).map(pid=>{
    const s=scores[pid]||{};
    return {name:players[pid].name,total:(s.bingo||0)+(s.bango||0)+(s.bongo||0)};
  }).sort((a,b)=>b.total-a.total);

  leaderboard.innerHTML=rows.map(r=>`
    <div class="lb-row">
      <span>${r.name}</span>
      <span class="lb-total">${r.total}</span>
    </div>`).join("");

  // Scoreboard
  scoreboard.innerHTML=Object.keys(players).map(pid=>{
    const s=scores[pid]||{};
    return `
    <div class="player">
      <div class="player-head">
        <span>${players[pid].name}</span>
        <span>${(s.bingo||0)+(s.bango||0)+(s.bongo||0)}</span>
      </div>
      <div class="buckets">
        ${["bingo","bango","bongo"].map(b=>`
          <div class="bucket">
            <small>${b}</small>
            <button class="plus" onclick="add('${pid}','${b}')">+1</button>
          </div>`).join("")}
      </div>
    </div>`;
  }).join("");
});

window.add=(pid,b)=>{
  const r=ref(db,`games/bingoBangoBongo/sessions/${sessionId}/scores/${pid}/${b}`);
  onValue(r,s=>update(r,(s.val()||0)+1),{onlyOnce:true});
};
</script>

</body>
</html>
