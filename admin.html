<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FTK Classic 2025 – Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" type="image/png" href="IMG_7296.jpg" />
  <style>
    :root {
      --red: #b91c1c;
      --blue: #1d4ed8;
      --bg: #f3f4f6;
      --card: #ffffff;
      --text: #111827;
      --muted: #6b7280;
      --border: #d1d5db;
      --danger: #b91c1c;
      --danger-soft: #fee2e2;
      --accent: #1d4ed8;
      --accent-soft: #dbeafe;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", sans-serif;
    }

    body {
      background: var(--bg);
      color: var(--text);
      min-height: 100vh;
      padding: 0.75rem;
    }

    @media (min-width: 768px) {
      body {
        max-width: 900px;
        margin: 0 auto;
      }
    }

    .site-header {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      margin-bottom: 0.5rem;
    }

    .site-header-left {
      display: flex;
      align-items: center;
      gap: 0.6rem;
    }

    .site-logo {
      height: 32px;
      width: auto;
      border-radius: 0.45rem;
      object-fit: cover;
      background: #e5e7eb;
    }

    .site-title {
      font-size: 1rem;
      font-weight: 700;
    }

    .site-subtitle {
      font-size: 0.75rem;
      color: var(--muted);
    }

    .nav-links {
      margin-left: auto;
      display: flex;
      gap: 0.4rem;
      flex-wrap: wrap;
    }

    .nav-btn {
      font-size: 0.8rem;
      border-radius: 999px;
      padding: 0.25rem 0.7rem;
      border: 1px solid var(--border);
      background: #ffffff;
      text-decoration: none;
      color: var(--text);
    }

    .nav-btn.secondary {
      background: #f3f4f6;
    }

    main {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
      padding-bottom: 2rem;
    }

    .card {
      background: var(--card);
      border-radius: 0.9rem;
      padding: 0.75rem;
      border: 1px solid var(--border);
    }

    .admin-banner {
      background: #fef3c7;
      border: 1px solid #facc15;
      color: #92400e;
      border-radius: 0.5rem;
      padding: 0.35rem 0.6rem;
      font-size: 0.8rem;
      margin-bottom: 0.35rem;
      text-align: center;
    }

    .section-title {
      font-size: 0.9rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.08em;
      color: var(--muted);
      margin-bottom: 0.35rem;
      border-bottom: 1px solid #e5e7eb;
      padding-bottom: 0.25rem;
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-bottom: 0.4rem;
      align-items: center;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 0.15rem;
      flex: 1;
      min-width: 120px;
    }

    label {
      font-size: 0.75rem;
      color: var(--muted);
    }

    input[type="text"],
    input[type="number"],
    select {
      border-radius: 0.5rem;
      border: 1px solid var(--border);
      padding: 0.35rem 0.4rem;
      font-size: 0.85rem;
      background: #f9fafb;
    }

    input[type="number"] {
      -moz-appearance: textfield;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .btn {
      border-radius: 999px;
      border: 1px solid var(--border);
      padding: 0.35rem 0.8rem;
      font-size: 0.8rem;
      background: #ffffff;
      cursor: pointer;
    }

    .btn-primary {
      border-color: #1d4ed8;
      background: linear-gradient(135deg, #1d4ed8, #2563eb);
      color: #ffffff;
      font-weight: 600;
    }

    .btn-danger {
      border-color: #fecaca;
      background: var(--danger-soft);
      color: var(--danger);
      font-weight: 600;
    }

    .btn-sm {
      padding: 0.25rem 0.6rem;
      font-size: 0.75rem;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.3rem;
    }

    .team-row {
      display: flex;
      gap: 0.5rem;
      flex-wrap: wrap;
    }

    .team-box {
      flex: 1;
      min-width: 130px;
    }

    .team-label-red {
      font-size: 0.75rem;
      color: var(--red);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .team-label-blue {
      font-size: 0.75rem;
      color: var(--blue);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.06em;
    }

    .players-list {
      margin-top: 0.4rem;
      border-radius: 0.7rem;
      border: 1px solid #e5e7eb;
      overflow: hidden;
      max-height: 360px;
      overflow-y: auto;
      background: #f9fafb;
    }

    .player-row {
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.9fr) minmax(0, 0.7fr) minmax(0, 1fr) auto;
      gap: 0.4rem;
      align-items: center;
      padding: 0.35rem 0.5rem;
      border-bottom: 1px solid #e5e7eb;
    }

    .player-row:nth-child(odd) {
      background: #f3f4f6;
    }

    .player-row:last-child {
      border-bottom: none;
    }

    .player-row label {
      font-size: 0.72rem;
      color: var(--muted);
    }

    .player-row input,
    .player-row select {
      width: 100%;
    }

    .player-actions {
      display: flex;
      gap: 0.25rem;
      justify-content: flex-end;
    }

    .players-header {
      font-size: 0.75rem;
      color: var(--muted);
      padding: 0.2rem 0.5rem;
      border-bottom: 1px solid #e5e7eb;
      background: #e5e7eb;
      display: grid;
      grid-template-columns: minmax(0, 1.4fr) minmax(0, 0.9fr) minmax(0, 0.7fr) minmax(0, 1fr) auto;
      gap: 0.4rem;
    }

    .players-header div {
      font-weight: 600;
    }

    .mulligan-badges {
      display: flex;
      gap: 0.25rem;
      align-items: center;
      justify-content: flex-start;
    }

    .pill-btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      padding: 0.12rem 0.5rem;
      font-size: 0.7rem;
      background: #ffffff;
      cursor: pointer;
      line-height: 1.2;
      white-space: nowrap;
    }

    .pill-btn.active {
      background: #dcfce7;
      border-color: #22c55e;
      color: #166534;
      font-weight: 600;
    }

    .matches-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 0.6rem;
      margin-top: 0.4rem;
    }

    .match-card {
      border-radius: 0.8rem;
      border: 1px solid #e5e7eb;
      padding: 0.5rem 0.55rem;
      background: #f9fafb;
    }

    .match-title-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 0.3rem;
    }

    .match-title {
      font-size: 0.85rem;
      font-weight: 600;
    }

    .match-type-label {
      font-size: 0.72rem;
      color: var(--muted);
    }

    .match-row {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .match-team {
      display: flex;
      flex-direction: column;
      gap: 0.2rem;
    }

    .match-team-label {
      font-size: 0.75rem;
      color: var(--muted);
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
    }

    .match-team-label.red {
      color: var(--red);
    }

    .match-team-label.blue {
      color: var(--blue);
    }

    .match-team-selects {
      display: flex;
      gap: 0.3rem;
    }

    .match-team-selects select {
      flex: 1;
    }

    .small-hint {
      font-size: 0.72rem;
      color: var(--muted);
      margin-top: 0.25rem;
    }

    .danger-zone {
      margin-top: 0.35rem;
      font-size: 0.75rem;
      color: var(--muted);
    }

    .danger-zone span {
      font-weight: 600;
      color: var(--danger);
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="site-header-left">
      <img src="IMG_7296.jpg" alt="FTK Classic logo" class="site-logo" />
      <div>
        <div class="site-title">FTK Classic</div>
        <div class="site-subtitle">Tournament Admin</div>
      </div>
    </div>
    <div class="nav-links">
      <a href="spectator.html" class="nav-btn secondary">View scores</a>
      <a href="index.html" class="nav-btn">Public home</a>
    </div>
  </header>

  <div class="admin-banner">
    ADMIN MODE – Any changes here update live for all spectators.
  </div>

  <main>
    <!-- TEAM SETTINGS -->
    <section class="card">
      <div class="section-title">Team settings</div>
      <div class="team-row">
        <div class="team-box">
          <div class="team-label-red">Red team name</div>
          <input type="text" id="teamRedName" placeholder="Red Team" />
        </div>
        <div class="team-box">
          <div class="team-label-blue">Blue team name</div>
          <input type="text" id="teamBlueName" placeholder="Blue Team" />
        </div>
      </div>
      <div class="btn-row">
        <button class="btn btn-primary btn-sm" id="saveTeamNamesBtn">Save team names</button>
      </div>
    </section>

    <!-- PLAYERS -->
    <section class="card">
      <div class="section-title">Players & handicaps</div>

      <div class="field-row">
        <div class="field">
          <label for="newPlayerName">Player name</label>
          <input type="text" id="newPlayerName" placeholder="First Last" />
        </div>
        <div class="field">
          <label for="newPlayerTeam">Team</label>
          <select id="newPlayerTeam">
            <option value="red">Red</option>
            <option value="blue">Blue</option>
          </select>
        </div>
        <div class="field">
          <label for="newPlayerHcp">Handicap</label>
          <input type="number" step="0.1" id="newPlayerHcp" placeholder="0.0" />
        </div>
      </div>

      <div class="btn-row">
        <button class="btn btn-primary btn-sm" id="addPlayerBtn">Add player</button>
      </div>

      <div class="small-hint">
        Edit players below. Toggle <strong>M</strong> and <strong>RM</strong> to mark mulligan usage, or click <strong>Save</strong> on a row to update name/team/handicap.
      </div>

      <div class="players-list" id="playersList"></div>
    </section>

    <!-- MATCHES -->
    <section class="card">
      <div class="section-title">Match pairings (16 matches)</div>
      <div class="small-hint">
        1–8 are Front 9 matches • 9–16 are Back 9 matches.  
        A player can only be used once per side on each 9.
      </div>

      <div class="matches-grid" id="matchesGrid"></div>

      <div class="btn-row">
        <button class="btn btn-danger btn-sm" id="resetScoresBtn">Reset ALL match scores</button>
      </div>
      <div class="danger-zone">
        <span>Warning:</span> Resetting scores will clear all hole results for all 16 matches.
      </div>
    </section>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
    import {
      getDatabase,
      ref,
      onValue,
      set,
      update,
      push,
      remove,
    } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD5fk91DPgPBkJ3_xGnNntD3PQbi5Ib3kg",
      authDomain: "ftkclassicdb.firebaseapp.com",
      databaseURL: "https://ftkclassicdb-default-rtdb.firebaseio.com",
      projectId: "ftkclassicdb",
      storageBucket: "ftkclassicdb.firebasestorage.app",
      messagingSenderId: "963469808092",
      appId: "1:963469808092:web:e6e789ce20ef46404b3f19"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    const settingsRef = ref(db, "settings");
    const playersRef = ref(db, "players");
    const matchesRef = ref(db, "matches");

    const teamRedNameInput = document.getElementById("teamRedName");
    const teamBlueNameInput = document.getElementById("teamBlueName");
    const saveTeamNamesBtn = document.getElementById("saveTeamNamesBtn");

    const newPlayerNameInput = document.getElementById("newPlayerName");
    const newPlayerTeamSelect = document.getElementById("newPlayerTeam");
    const newPlayerHcpInput = document.getElementById("newPlayerHcp");
    const addPlayerBtn = document.getElementById("addPlayerBtn");
    const playersListEl = document.getElementById("playersList");

    const matchesGridEl = document.getElementById("matchesGrid");
    const resetScoresBtn = document.getElementById("resetScoresBtn");

    let settings = {};
    let players = {};
    let matches = {};
    let matchesLoaded = false;

    // ----- TEAM NAMES -----

    function applyTeamNamesUI() {
      const t = settings.teamNames || {};
      if (teamRedNameInput.value === "") {
        teamRedNameInput.value = t.red || "Red";
      }
      if (teamBlueNameInput.value === "") {
        teamBlueNameInput.value = t.blue || "Blue";
      }
    }

    saveTeamNamesBtn.addEventListener("click", async () => {
      const redName = teamRedNameInput.value.trim() || "Red";
      const blueName = teamBlueNameInput.value.trim() || "Blue";
      await update(settingsRef, {
        teamNames: {
          red: redName,
          blue: blueName,
        },
      });
      alert("Team names updated.");
    });

    // ----- PLAYERS -----

    function renderPlayersList() {
      const ids = Object.keys(players || {});
      if (!ids.length) {
        playersListEl.innerHTML = `
          <div style="font-size:0.8rem;color:#6b7280;text-align:center;padding:0.6rem;">
            No players yet. Add players above.
          </div>
        `;
        return;
      }

      ids.sort((a, b) => {
        const pa = players[a];
        const pb = players[b];
        return (pa.name || "").localeCompare(pb.name || "");
      });

      let html = `
        <div class="players-header">
          <div>Name</div>
          <div>Team</div>
          <div>Handicap</div>
          <div>Mulligans</div>
          <div style="text-align:right;">Actions</div>
        </div>
      `;

      for (const id of ids) {
        const p = players[id];
        const name = p.name || "";
        const team = (p.team || "red").toLowerCase();
        const hcp = p.handicap !== undefined && p.handicap !== null ? p.handicap : "";
        const mUsed = !!p.mulliganUsed;
        const rmUsed = !!p.reverseMulliganUsed;

        html += `
          <div class="player-row" data-id="${id}">
            <div>
              <label>Name</label>
              <input type="text" value="${name.replace(/"/g, "&quot;")}" class="player-name-input" />
            </div>
            <div>
              <label>Team</label>
              <select class="player-team-select">
                <option value="red" ${team === "red" ? "selected" : ""}>Red</option>
                <option value="blue" ${team === "blue" ? "selected" : ""}>Blue</option>
              </select>
            </div>
            <div>
              <label>HCP</label>
              <input type="number" step="0.1" value="${hcp}" class="player-hcp-input" />
            </div>
            <div>
              <label>M / RM</label>
              <div class="mulligan-badges">
                <button type="button" class="pill-btn mulligan-toggle ${mUsed ? "active" : ""}">M</button>
                <button type="button" class="pill-btn reverse-toggle ${rmUsed ? "active" : ""}">RM</button>
              </div>
            </div>
            <div class="player-actions">
              <button type="button" class="btn btn-sm player-save-btn">Save</button>
              <button type="button" class="btn btn-sm btn-danger player-delete-btn">Delete</button>
            </div>
          </div>
        `;
      }

      playersListEl.innerHTML = html;

      const rows = playersListEl.querySelectorAll(".player-row");
      rows.forEach((row) => {
        const id = row.getAttribute("data-id");
        const nameInput = row.querySelector(".player-name-input");
        const teamSelect = row.querySelector(".player-team-select");
        const hcpInput = row.querySelector(".player-hcp-input");
        const saveBtn = row.querySelector(".player-save-btn");
        const delBtn = row.querySelector(".player-delete-btn");
        const mulliganBtn = row.querySelector(".mulligan-toggle");
        const reverseBtn = row.querySelector(".reverse-toggle");

        saveBtn.addEventListener("click", async () => {
          const updatedName = nameInput.value.trim();
          const updatedTeam = teamSelect.value;
          const updatedHcpRaw = hcpInput.value.trim();
          const updatedHcp = updatedHcpRaw === "" ? "" : parseFloat(updatedHcpRaw);

          await update(ref(db, "players/" + id), {
            name: updatedName,
            team: updatedTeam,
            handicap: updatedHcp,
          });
          alert("Player updated.");
        });

        delBtn.addEventListener("click", async () => {
          if (!confirm("Delete this player? They will be removed from any matches.")) return;
          await remove(ref(db, "players/" + id));
        });

        mulliganBtn.addEventListener("click", async () => {
          const current = !!(players[id]?.mulliganUsed);
          await update(ref(db, "players/" + id), {
            mulliganUsed: !current,
          });
        });

        reverseBtn.addEventListener("click", async () => {
          const current = !!(players[id]?.reverseMulliganUsed);
          await update(ref(db, "players/" + id), {
            reverseMulliganUsed: !current,
          });
        });
      });
    }

    addPlayerBtn.addEventListener("click", async () => {
      const name = newPlayerNameInput.value.trim();
      const team = newPlayerTeamSelect.value;
      const hRaw = newPlayerHcpInput.value.trim();
      if (!name) {
        alert("Please enter a player name.");
        return;
      }
      const hVal = hRaw === "" ? "" : parseFloat(hRaw);

      const newRef = push(playersRef);
      await set(newRef, {
        name,
        team,
        handicap: hVal,
        mulliganUsed: false,
        reverseMulliganUsed: false,
      });

      newPlayerNameInput.value = "";
      newPlayerHcpInput.value = "";
    });

    // ----- MATCHES -----

    function ensureMatchesStructure() {
      if (!matchesLoaded) return;

      const updated = { ...(matches || {}) };
      let changed = false;

      for (let i = 1; i <= 16; i++) {
        const key = String(i);
        if (!updated[key]) {
          updated[key] = {
            type: i <= 8 ? "front" : "back",
            red: { players: [] },
            blue: { players: [] },
            holes: Array(18).fill("none"),
          };
          changed = true;
        } else {
          if (!updated[key].holes || !Array.isArray(updated[key].holes)) {
            updated[key].holes = Array(18).fill("none");
            changed = true;
          }
          if (!updated[key].red) {
            updated[key].red = { players: [] };
            changed = true;
          }
          if (!updated[key].blue) {
            updated[key].blue = { players: [] };
            changed = true;
          }
          if (!updated[key].type) {
            updated[key].type = i <= 8 ? "front" : "back";
            changed = true;
          }
        }
      }

      if (changed) {
        set(matchesRef, updated);
      }

      matches = updated;
    }

    function renderMatchesGrid() {
      if (!matchesLoaded) {
        matchesGridEl.innerHTML = `
          <div style="font-size:0.8rem;color:#6b7280;text-align:center;padding:0.6rem;">
            Loading matches…
          </div>
        `;
        return;
      }

      ensureMatchesStructure();

      const redPlayersList = Object.entries(players || {})
        .filter(([, p]) => (p.team || "").toLowerCase() === "red")
        .map(([id, p]) => ({ id, name: p.name || "Unnamed" }))
        .sort((a, b) => a.name.localeCompare(b.name));

      const bluePlayersList = Object.entries(players || {})
        .filter(([, p]) => (p.team || "").toLowerCase() === "blue")
        .map(([id, p]) => ({ id, name: p.name || "Unnamed" }))
        .sort((a, b) => a.name.localeCompare(b.name));

      const usedRedFront = new Set();
      const usedRedBack = new Set();
      const usedBlueFront = new Set();
      const usedBlueBack = new Set();

      for (let i = 1; i <= 16; i++) {
        const key = String(i);
        const m = matches[key] || {};
        const type = m.type || (i <= 8 ? "front" : "back");
        const redSel = m.red?.players || [];
        const blueSel = m.blue?.players || [];

        if (type === "front") {
          redSel.forEach((pid) => usedRedFront.add(pid));
          blueSel.forEach((pid) => usedBlueFront.add(pid));
        } else {
          redSel.forEach((pid) => usedRedBack.add(pid));
          blueSel.forEach((pid) => usedBlueBack.add(pid));
        }
      }

      let html = "";

      for (let i = 1; i <= 16; i++) {
        const key = String(i);
        const m = matches[key] || {};
        const type = m.type || (i <= 8 ? "front" : "back");
        const typeLabel = type === "front" ? "Front 9" : "Back 9";
        const redSel = m.red?.players || [];
        const blueSel = m.blue?.players || [];

        const redAvailable = redPlayersList.filter((p) => {
          const inThis = redSel.includes(p.id);
          if (inThis) return true;
          if (type === "front") return !usedRedFront.has(p.id);
          return !usedRedBack.has(p.id);
        });

        const blueAvailable = bluePlayersList.filter((p) => {
          const inThis = blueSel.includes(p.id);
          if (inThis) return true;
          if (type === "front") return !usedBlueFront.has(p.id);
          return !usedBlueBack.has(p.id);
        });

        html += `
          <div class="match-card" data-id="${key}">
            <div class="match-title-row">
              <div class="match-title">Match ${key}</div>
              <div class="match-type-label">${typeLabel}</div>
            </div>
            <div class="match-row">
              <div class="match-team">
                <div class="match-team-label red">Red pair</div>
                <div class="match-team-selects">
                  <select class="match-red-p1">
                    <option value="">Select player</option>
                    ${redAvailable.map(p => `
                      <option value="${p.id}" ${redSel[0] === p.id ? "selected" : ""}>
                        ${p.name.replace(/"/g, "&quot;")}
                      </option>
                    `).join("")}
                  </select>
                  <select class="match-red-p2">
                    <option value="">Select player</option>
                    ${redAvailable.map(p => `
                      <option value="${p.id}" ${redSel[1] === p.id ? "selected" : ""}>
                        ${p.name.replace(/"/g, "&quot;")}
                      </option>
                    `).join("")}
                  </select>
                </div>
              </div>
              <div class="match-team">
                <div class="match-team-label blue">Blue pair</div>
                <div class="match-team-selects">
                  <select class="match-blue-p1">
                    <option value="">Select player</option>
                    ${blueAvailable.map(p => `
                      <option value="${p.id}" ${blueSel[0] === p.id ? "selected" : ""}>
                        ${p.name.replace(/"/g, "&quot;")}
                      </option>
                    `).join("")}
                  </select>
                  <select class="match-blue-p2">
                    <option value="">Select player</option>
                    ${blueAvailable.map(p => `
                      <option value="${p.id}" ${blueSel[1] === p.id ? "selected" : ""}>
                        ${p.name.replace(/"/g, "&quot;")}
                      </option>
                    `).join("")}
                  </select>
                </div>
              </div>
            </div>
            <div class="small-hint">
              Changes are saved automatically when you change a dropdown.  
              Players can only appear once per side on each 9.
            </div>
            <div class="btn-row">
              <button type="button" class="btn btn-sm reset-match-scores-btn">Reset scores for this match</button>
              <button type="button" class="btn btn-sm" onclick="window.location.href='match.html?id=${key}'">
                Open scoring page
              </button>
            </div>
          </div>
        `;
      }

      matchesGridEl.innerHTML = html;

      const cards = matchesGridEl.querySelectorAll(".match-card");
      cards.forEach(card => {
        const id = card.getAttribute("data-id");
        const redP1 = card.querySelector(".match-red-p1");
        const redP2 = card.querySelector(".match-red-p2");
        const blueP1 = card.querySelector(".match-blue-p1");
        const blueP2 = card.querySelector(".match-blue-p2");
        const resetMatchBtn = card.querySelector(".reset-match-scores-btn");

        async function savePairings() {
          const r1 = redP1.value || null;
          const r2 = redP2.value || null;
          const b1 = blueP1.value || null;
          const b2 = blueP2.value || null;

          const redPlayers = [r1, r2].filter(Boolean);
          const bluePlayers = [b1, b2].filter(Boolean);

          const current = matches[id] || {};
          const newData = {
            type: current.type || (Number(id) <= 8 ? "front" : "back"),
            holes: current.holes || Array(18).fill("none"),
            red: { players: redPlayers },
            blue: { players: bluePlayers },
          };

          await set(ref(db, "matches/" + id), newData);
        }

        redP1.addEventListener("change", savePairings);
        redP2.addEventListener("change", savePairings);
        blueP1.addEventListener("change", savePairings);
        blueP2.addEventListener("change", savePairings);

        resetMatchBtn.addEventListener("click", async () => {
          if (!confirm(`Reset all scores for match ${id}?`)) return;
          await update(ref(db, "matches/" + id), {
            holes: Array(18).fill("none"),
          });
          alert(`Scores reset for match ${id}.`);
        });
      });
    }

    resetScoresBtn.addEventListener("click", async () => {
      if (!confirm("Reset ALL match scores for all 16 matches?")) return;
      const updates = {};
      for (let i = 1; i <= 16; i++) {
        updates[String(i)] = {
          ...(matches[String(i)] || {}),
          holes: Array(18).fill("none"),
        };
      }
      await set(matchesRef, updates);
      alert("All match scores reset.");
    });

    // ----- REALTIME LISTENERS -----

    onValue(settingsRef, (snapshot) => {
      settings = snapshot.val() || {};
      applyTeamNamesUI();
    });

    onValue(playersRef, (snapshot) => {
      players = snapshot.val() || {};
      renderPlayersList();
      renderMatchesGrid();
    });

    onValue(matchesRef, (snapshot) => {
      matches = snapshot.val() || {};
      matchesLoaded = true;
      renderMatchesGrid();
    });
  </script>
</body>
</html>
