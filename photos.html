<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>FTK Classic – Photos</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <link rel="icon" type="image/png" href="IMG_7296.jpg" />

  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --text:#111827;
      --muted:#6b7280;
      --border:#d1d5db;
    }

    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,sans-serif;}
    body{background:var(--bg);color:var(--text);}

    /* HEADER */
    header{
      position:sticky;top:0;z-index:5;
      background:#f3f4f6;
      border-bottom:1px solid #e5e7eb;
      padding:.75rem 1rem;
      display:flex;align-items:center;gap:.75rem;
    }
    header img{width:38px;height:38px;border-radius:10px;}
    header h1{font-size:1rem;font-weight:900;}
    header span{font-size:.8rem;color:var(--muted);}

    main{max-width:1100px;margin:0 auto;padding:1rem;}

    .group{
      background:#fff;border:1px solid #e5e7eb;border-radius:16px;
      padding:.75rem;margin-bottom:.75rem;
    }
    .group-title{font-weight:900;margin-bottom:.5rem;}

    .grid{
      display:grid;grid-template-columns:repeat(4,1fr);gap:.5rem;
    }
    @media(max-width:900px){.grid{grid-template-columns:repeat(3,1fr)}}
    @media(max-width:600px){.grid{grid-template-columns:repeat(2,1fr)}}

    .thumb{
      aspect-ratio:4/3;
      background:#f9fafb;
      border-radius:12px;
      overflow:hidden;
      cursor:pointer;
    }
    .thumb img{
      width:100%;height:100%;object-fit:contain;
    }

    /* FULLSCREEN VIEWER */
    #viewer{
      position:fixed;inset:0;
      background:#000;
      display:none;
      z-index:100;
      touch-action:pan-y;
    }
    #viewer.show{display:block;}

    #viewerHeader{
      position:fixed;
      top:0;left:0;right:0;
      display:flex;justify-content:space-between;align-items:center;
      padding:
        calc(.75rem + env(safe-area-inset-top))
        calc(1rem + env(safe-area-inset-right))
        .75rem
        calc(1rem + env(safe-area-inset-left));
      background:linear-gradient(to bottom,rgba(0,0,0,.8),rgba(0,0,0,0));
      color:#fff;
      z-index:110;
    }
    #viewerTitle{
      font-size:.9rem;font-weight:900;
      white-space:nowrap;overflow:hidden;text-overflow:ellipsis;
      max-width:70vw;
    }
    #viewerClose{
      height:38px;width:38px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.15);
      color:#fff;font-size:1.2rem;
    }

    #viewerImgWrap{
      position:absolute;inset:0;
      display:flex;align-items:center;justify-content:center;
      padding-top:70px;
    }
    #viewerImg{
      max-width:100%;max-height:100%;
      object-fit:contain;
      pointer-events:none;
    }

    /* BOTTOM DONE BUTTON (BULLETPROOF EXIT) */
    #viewerDone{
      position:fixed;
      left:50%;transform:translateX(-50%);
      bottom:calc(14px + env(safe-area-inset-bottom));
      height:46px;padding:0 22px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.3);
      background:rgba(255,255,255,.18);
      color:#fff;font-weight:900;
      z-index:120;
    }
  </style>
</head>

<body>
<header>
  <img src="IMG_7296.jpg" />
  <div>
    <h1>FTK Classic</h1>
    <span id="subtitle">Photos</span>
  </div>
</header>

<main>
  <div id="photosRoot">Loading photos…</div>
</main>

<!-- FULLSCREEN VIEWER -->
<div id="viewer">
  <div id="viewerHeader">
    <div id="viewerTitle">Photo</div>
    <button id="viewerClose">✕</button>
  </div>

  <div id="viewerImgWrap">
    <img id="viewerImg" />
  </div>

  <button id="viewerDone">Done</button>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getDatabase, ref, onValue } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-database.js";

const app = initializeApp({
  apiKey: "AIzaSyD5fk91DPgPBkJ3_xGnNntD3PQbi5Ib3kg",
  authDomain: "ftkclassicdb.firebaseapp.com",
  databaseURL: "https://ftkclassicdb-default-rtdb.firebaseio.com",
  projectId: "ftkclassicdb",
  storageBucket: "ftkclassicdb.firebasestorage.app",
  messagingSenderId: "963469808092",
  appId: "1:963469808092:web:e6e789ce20ef46404b3f19"
});
const db = getDatabase(app);

const photosRoot = document.getElementById("photosRoot");
const viewer = document.getElementById("viewer");
const viewerImg = document.getElementById("viewerImg");
const viewerTitle = document.getElementById("viewerTitle");

let gallery = [];
let current = 0;

function openViewer(idx){
  current = idx;
  viewerImg.src = gallery[current].url;
  viewerTitle.textContent = gallery[current].title || "Photo";
  viewer.classList.add("show");
}

function closeViewer(){
  viewer.classList.remove("show");
  viewerImg.src = "";
}

document.getElementById("viewerClose").onclick = closeViewer;
document.getElementById("viewerDone").onclick = closeViewer;

let startX = 0;
viewer.addEventListener("touchstart", e => startX = e.touches[0].clientX);
viewer.addEventListener("touchend", e => {
  const dx = e.changedTouches[0].clientX - startX;
  if(Math.abs(dx) > 50){
    current = dx < 0 ? (current+1)%gallery.length : (current-1+gallery.length)%gallery.length;
    viewerImg.src = gallery[current].url;
  }
});

onValue(ref(db,"photos"), snap => {
  const data = snap.val() || {};
  gallery = Object.values(data).map(p => ({url:p.url,title:p.matchLabel||"Photo"}));

  photosRoot.innerHTML = `
    <div class="group">
      <div class="group-title">Tournament Photos</div>
      <div class="grid">
        ${gallery.map((p,i)=>`
          <div class="thumb" data-i="${i}">
            <img src="${p.url}" />
          </div>`).join("")}
      </div>
    </div>
  `;

  photosRoot.querySelectorAll(".thumb").forEach(el=>{
    el.onclick = ()=>openViewer(+el.dataset.i);
  });
});
</script>
</body>
</html>
